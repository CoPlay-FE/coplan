name: CI Pipeline

on:
  pull_request:
    branches: [develop, main]
  push:
    branches: [develop, main]

jobs:
  eslint-check:
    runs-on: self-hosted
    timeout-minutes: 2

    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 2 # HEADì™€ HEAD~1ì„ ëª¨ë‘ ê°€ì ¸ì˜¤ê¸°

      - name: Lightning fast lint check
        run: |
          echo "âš¡ Quick lint check..."

          # ë” ì•ˆì „í•œ ë³€ê²½ íŒŒì¼ ê°ì§€
          if git rev-parse --verify HEAD~1 >/dev/null 2>&1; then
            # HEAD~1ì´ ì¡´ì¬í•˜ëŠ” ê²½ìš° (ì¼ë°˜ì ì¸ ê²½ìš°)
            CHANGED_FILES=$(git diff --name-only HEAD~1 -- '*.ts' '*.tsx' '*.js' '*.jsx')
            echo "ğŸ” Checking changed files since last commit"
          else
            # ì²« ì»¤ë°‹ì´ê±°ë‚˜ shallow cloneì¸ ê²½ìš°
            echo "ğŸ” Checking recent TypeScript/JavaScript files..."
            CHANGED_FILES=$(find . -name "*.ts" -o -name "*.tsx" -o -name "*.js" -o -name "*.jsx" | grep -v node_modules | head -10)
          fi

          # ë³€ê²½ì‚¬í•­ ì—†ìœ¼ë©´ ì¦‰ì‹œ ì¢…ë£Œ
          if [ -z "$CHANGED_FILES" ]; then
            echo "âœ… No JS/TS files to check"
            exit 0
          fi

          # ê¸€ë¡œë²Œ ESLint ì‚¬ìš©
          echo "ğŸ“ Checking: $CHANGED_FILES"
          npx eslint $CHANGED_FILES
          echo "âœ… Lint check passed!"
